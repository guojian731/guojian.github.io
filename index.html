<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/guojian731.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/guojian731.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/guojian731.github.io/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/guojian731.github.io/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/guojian731.github.io/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/guojian731.github.io/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/guojian731.github.io/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Notes">
<meta property="og:url" content="https://guojian731.github.io/guojian731.github.io/index.html">
<meta property="og:site_name" content="Notes">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/guojian731.github.io/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://guojian731.github.io/guojian731.github.io/"/>





  <title>Notes</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/guojian731.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/guojian731.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/guojian731.github.io/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/guojian731.github.io/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/guojian731.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/04/15/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/04/15/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-15T01:13:47+08:00">
                2018-04-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/02/06/rabbitmq-8-负载均衡与故障转移/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/02/06/rabbitmq-8-负载均衡与故障转移/" itemprop="url">rabbitmq-8-负载均衡与故障转移</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-06T16:33:14+08:00">
                2018-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitmq-8-负载均衡与故障转移/r8.png" alt="jvm装载步骤"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/29/rabbitmq-7-设置集群/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/29/rabbitmq-7-设置集群/" itemprop="url">rabbitmq-7-设置集群</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-29T17:08:53+08:00">
                2018-01-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitmq-7-设置集群/r7.png" alt="jvm装载步骤"></p>
<p>之前我们已经设置了单机版的rabbitmq，并且设置了user、exchange、queue、vhost等。现在我们要在我们的电脑里设置集群啦。我使用的是虚拟机，所以很轻松的就复制了之前的rabbitmq环境来进行集群设置。</p>
<h1 id="集群你要知道"><a href="#集群你要知道" class="headerlink" title="集群你要知道"></a>集群你要知道</h1><p><em>之前我们了解了一些rabbitmq的基础知识，包括单机版安装、rabbitmq的构成等。如果你的rabbitmq服务器遇到内存崩溃了或者断电的情况，那么我们该进行集群啦。</em></p>
<h2 id="集群架构"><a href="#集群架构" class="headerlink" title="集群架构"></a>集群架构</h2><p>到目前为止，我们对于rabbitmq的内部还算不上了解。确实，我们知道队列和交换器的含义，以及如何将它们绑定在一起。也知道该使用哪种类型的交换器。但是背后发生了什么，这是我们不知道的。Rabbitmq是如何记录所有你使用的各种基础构件，同时它们又如何装配成一个消息通讯服务器的呢？</p>
<p>Rabbitmq会始终记录一下四种类型的内部元数据：</p>
<ul>
<li>队列元数据——队列名称和它们的属性(是否可持久化，是否自动删除？)</li>
<li>交换器元数据——交换器名称、类型和属性(可持久化等)</li>
<li>绑定元数据——一张简单的表格展示了如何将消息路由到队列</li>
<li>vhost——为vhost内的队列、交换器和绑定提供命名空间和安全属性</li>
</ul>
<font color="red" size="4"><em>注意！！队列的元数据不包括队列里面的内容，队列中的消息在重启之后还是会消失的。</em></font><br><br><font color="red" size="4"><em>rabbitmq存储数据有两种方式，一种为disc(硬盘)存储，一种为(ram)内存存储</em></font>

<p>在单一节点内，rabbitmq会将所有的这些信息存储在内存中，同时将哪些标记为可持久化的队列和交换器(以及他们的绑定)存储到硬盘上。存储到硬盘上可以确保队列和交换器在重启Rabbitmq节点后重新创建。<br>当你引入集群时，rabbitmq需要追踪新的元数据类型：集群节点位置，以及节点与已记录的其它类型元数据的关系。集群也提供了选择：将元数据存储到磁盘上(独立节点的默认设置)，或者仅存储在ram中。但是<br>在我们深入到集群节点和他们如何存储元数据前，我们首先理解在集群环境中队列和交换器的行为。</p>
<h2 id="集群中的队列"><a href="#集群中的队列" class="headerlink" title="集群中的队列"></a>集群中的队列</h2><p>在将两个节点组成集群的那一刻，事情发生了巨大的变化：不是没一个节点都有所有队列的完全拷贝。在单一节点设置中，所有关于队列的的信息(元数据、状态和内容)都完全的存储在该节点上。<font color="red" size="3"><em>但是如果在集群中创建队列的话，集群只会在单个节点而不是在所有节点上创建完整的队列信息(元数据、状态和内容)。</em></font>所以，只有队列的所有者节点知道有关这个队列的所有信息。所有其他非所有者节点指挥知道队列的元数据和指向该队列存在的那个节点的指针。因此，在集群崩溃时，该节点的队列和关联的绑定就都消失了。附加在那些队列上的消费者丢失了其订阅信息，并且任何匹配该队列绑定信息的新消息也都丢失了。</p>
<p>别担心，你可以让你的消费者重新连到集群并重新创建队列。这种做法仅当队列最开始没有设置成可持久化的时候才是可行的。如果重新创建的队列被标记为持久化了，那么在其他节点上重新声明他们的话会得到一个难看的404 NOT FOUND错误。这样确保了当失败节点恢复后加入集群，该节点上的队列消息不会丢失。想要该制定队列重回集群的唯一方法是恢复故障节点。但是如果消费者尝试重建的队列不是可持久化的，那么重新声明就会成功，你可以准备重新绑定他们并传输数据。</p>
<p><em>这样设置队列的原因：</em></p>
<ul>
<li><p>存储空间——如果每个集群节点都拥有所有队列的完成拷贝，那么添加新的节点不会给你带来更多的存储空间。举个例子，如果一个节点可以存储1GB的消息，那么添加两个节点只会给你带来两个一模一样的1GB的信息的拷贝。也就是说，两个节点里面存储的内容是一样的。</p>
</li>
<li><p>性能——消息的发布需要将消息复制到每一个集群节点。对于持久化消息来说，每一个消息都会触发磁盘活动。每次新增节点，网络和磁盘负载都会增加，最终只能保持集群性能的平稳，或者更糟，不会使性能更近一步。</p>
</li>
</ul>
<p>通过设置集群中的唯一节点来负责任何特定的队列，只有负责该节点才会因队列消息而遭受磁盘活动的影响。所有其他节点需要将接收的该队列的消息传递给该队列的所有者节点。因此，往rabbit集群添加更多的节点意味着你将拥有更多的节点来传播队列<br>，这些新增节点为你带来了性能的提升。当负载增加时，rabbitmq集群是性能扩展的最佳方案。</p>
<h2 id="分布式交换器"><a href="#分布式交换器" class="headerlink" title="分布式交换器"></a>分布式交换器</h2><p>到目前为止，我们一直把交换器描述得如同队列那样是一个活生生的实体。事实上，不同于队列那样拥有自己的进程，交换器说到底只是一个名称和一个队列绑定的列表。当你将消息发布到交换器上的时，实际上是由你所连接的信道将消息上的路由键同交换器的绑定列表进行比较，然后路有消息。正事信道按照绑定匹配的结果，将消息路由到队列。所以信道才是真正的路由器。</p>
<p><em>将每个队列想象成节点上运行的进程，每个进程拥有自己的PID。交换器只不过是由路有模式列表和匹配消息应发往的队列进程ID列表。当发布的消息匹配了交换器中的绑定时，实际上是由信道完成了匹配工作，并在匹配之后建立了队列PID的睑裂，然后将消息传递过去。队列的进程ID本质上是其在集群中的Erlang地址</em></p>
<p>由于交换器只不过是一张查询表，而非实际上的消息路由器，因此将交换器在整个集群中进行复制会更加简单。举例来说，当创建一个新的交换器时，rabbitmq所要做的是将查询表添加到集群中的所有节点上。这时，每个节点上的每条信道都可以访问新的交换器了。因此。对于默认情况下队列的完整信息存在集群中的单一节点来说，集群中的每个节点拥有每个交换器的所有信息。就可用性来讲，这非常棒，这意味着你不用担心在节点故障时重新声明交换器。只需让故障节点上的生产者重新连接到集群上，它们立即就能开始往交换器上发布消息了。</p>
<h2 id="内存节点和磁盘节点"><a href="#内存节点和磁盘节点" class="headerlink" title="内存节点和磁盘节点"></a>内存节点和磁盘节点</h2><p>每个rabbitmq节点，不管是单一节点系统或者是庞大的集群的一部分，要么是内存节点(ram),要么是磁盘节点(disc)。内存节点将所有的队列、交换器、绑定、用户和vhost的元数据定义都仅存储在内存中。而磁盘节点则将元数据存储在磁盘中。单节点系统只允许磁盘类型的节点；否则，每次你重启rabbitmq之后，所有关于系统的配置信息都会失效。不过在集群中，你可以选择配置部分节点为内存节点。为什么想要选择将元数据仅存储在内存中？因为它使得相对列和交换器声明之类的操作更加快速。</p>
<p>当在集群中声明队列、交换器或者绑定的时候，这些操作会知道所有的集群节点都成功提交元数据变更后才返回。对于内存节点来说，这意味着将变更写入内存；而对于磁盘节点来说，这意味着昂贵的磁盘写入操作，直到完成之后，节点才能说“完事了”。假设你有五个节点的集群，并且所有的节点都是磁盘节点，则你必须得等待所有这五个节点将元数据写入磁盘后，队列声明才做还能返回。对于队列长存的服务器来说这没有什么大不了的。但是如果在处理繁重的RPC，如果每个RPC客户端正在创建和销毁每秒数以万计的应答队列，那么就会明白磁盘节点会降低性能。内存节点可以提供出色的性能，和磁盘节点能够保障集群配置信息幸免于重启，如何平衡两者。</p>
<p>rabbitmq只要求在集群中至少有一个磁盘节点。所有其他节点可以是内存节点。记住，当节点加入或者离开集群时，他们必须要将该变更通知至少一个磁盘节点。如果只有一个磁盘节点，而且不凑巧的是他刚好又崩溃，那么集群可以继续路由消息，但是不能做一下操作了：</p>
<ul>
<li>创建队列</li>
<li>创建交换器</li>
<li>创建绑定</li>
<li>添加用户</li>
<li>更改权限</li>
<li>添加或删除集群节点</li>
</ul>
<p>换句话说，如果集群中唯一的磁盘节点崩溃的话，集群仍然可以保持运行，但是在该节点恢复到集群前，你无法更改任何东西。解决方案是在集群中设置两个磁盘节点，因此他们中至少有一个是可用的，能在任何时候保存元数据的变更。只要一个需要所有的磁盘节点必须在线的操作是添加或者删除节点。当内存节点重启后，它们会连接到预先配置的磁盘节点，下载当前集群的元数据拷贝。如果你只将两个磁盘节点中的一个告诉该内存节点，而不凑巧的是当内存节点供电中断该磁盘节点也发生故障的话，那么内存节点在重启之后就无法找到集群了。所以添加内存节点时，确保要告知其所有的磁盘节点(内存节点唯一存储到磁盘的元数据信息是集群中的磁盘节点的地址)。只要内存节点可以找到至少一个磁盘节点，那么她就能在重启后重新加入集群。</p>
<h1 id="在一台电脑上设置集群"><a href="#在一台电脑上设置集群" class="headerlink" title="在一台电脑上设置集群"></a>在一台电脑上设置集群</h1><ul>
<li>关闭Management插件</li>
</ul>
<p>我们在设置集群的时候，需要将management插件进行关闭，因为在你启用的management的时候，在同一台电脑启动多个rabbitmq的节点的时候，management的端口会冲突，management的默认端口号是15672。日志会显示端口号15672端口已被占用。初次设置集群的时候，最好不要用守护进程方式开启rabbitmq(-detached),如果你使用守护进程的方式开启rabbitmq，需要查看日志，因为rabbitmq默认守护进程，不会显示错误信息的。日志路径：rabbitmq所在目录下的/var/log/rabbitmq/rabbit_5673.log(5673是对应的端口)</p>
<p>关闭Management插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmq-plugins disable rabbitmq_management</span><br></pre></td></tr></table></figure>
<h2 id="启动三个节点"><a href="#启动三个节点" class="headerlink" title="启动三个节点"></a>启动三个节点</h2><p>首先先启动三个rabbitmq的应用程序，这里我们需要设置rabbitmq的端口号和节点名称，否则都使用默认的会发生端口、节点名称已被使用的异常。首先进入rabbitmq的安装目录下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit \./sbin/rabbitmq-server </span><br><span class="line"></span><br><span class="line">RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit_5673 \./sbin/rabbitmq-server </span><br><span class="line"></span><br><span class="line">RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit_5674 \./sbin/rabbitmq-server</span><br></pre></td></tr></table></figure>
<p>好了，我们现在启动了三个rabbitmq节点，分别是rabbit、rabbit_5673、rabbit_5674(每个节点后都有系统的主机名，添加在@后)。但是每一个节点都是独立的节点，拥有自己的元数据，并且不知道其他节点的存在。集群中的第一个节点将初始化数据带入集群中，并且无须被告知加入。而第二个和之后的节点将加入它并且获得他的元数据。要加入第二个和第三个节点，首先需要停止Erlang节点上运行的RabbitMQ应用程序，并重设(清空)他们的元数据。这样他们才可以被加入并获取集群的元数据。rabbitmqctl工具会帮你和每个节点通信并完成以上任务。</p>
<ul>
<li>停止端口号为5673的应用程序。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl -n rabbit_5673@localhost stop_app</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq1.png" alt="jvm装载步骤"></p>
<ul>
<li>将重设第二个节点的元数据和状态为清空的状态：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl -n rabbit_5673@localhost reset</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq2.png" alt="jvm装载步骤"></p>
<ul>
<li>将其加入集群</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl -n rabbit_5673@localhost join_cluster rabbit@localhost</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq3.png" alt="jvm装载步骤"></p>
<ul>
<li>重新启动第二个节点的应用程序，它就变成集群中的一元了</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl -n rabbit_5673@localhost start_app</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq4.png" alt="jvm装载步骤"></p>
<ul>
<li>查看集群信息</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl cluster_status</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq5.png" alt="jvm装载步骤"></p>
<p>我们可以看到，集群中有两个节点，而且都是运行状态。</p>
<p>我们在将第三个节点添加进来。</p>
<p><img src="rabbitmq-7-设置集群/rabbitmq6.png" alt="jvm装载步骤"></p>
<h2 id="设置节点类型"><a href="#设置节点类型" class="headerlink" title="设置节点类型"></a>设置节点类型</h2><p>我们通过./rabbitmqctl cluster_status命令查看了有关于节点的信息，我们发现我们添加的节点都是disc的，也就是数据都存储在硬盘上的。如何设置节点存储的信息在ram(内存中)呢。</p>
<p>首先我们先停止我们刚才加进来的5674节点，重新将它配制成ram节点，命令也非常简单。为什么我要先配置5672节点为disc之后，在设置为ram呢，其实没有前后关系，只是自己尝试去停止节点之后，再应用节点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl -n rabbit_5674<span class="meta">@localhost</span> join_cluster --ram rabbit<span class="meta">@localhost</span></span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq7.png" alt="jvm装载步骤"></p>
<p>我们这就可以看到集群5674节点为ram节点了。</p>
<h1 id="多服务器集群"><a href="#多服务器集群" class="headerlink" title="多服务器集群"></a>多服务器集群</h1><p><em>之前我们在一台机器上设置了集群，现在我们在试试在多台机器上设置集群，我们这里使用虚拟机建立三个服务器。集群需要rabbitmq、erlang的版本最好是一模一样，否则可能发生错误。</em></p>
<p>首先，我们需要知道rabbitmq集群对延迟非常敏感，应当指在本地局域网内使用。使用集群来提供地理可用性或者通过WAN来路由消息，都会导致超时和怪异的集群行为，因此这是不明智的。</p>
<p>我们虚拟机的ip地址分别为192.168.14.128，192.168.14.132，192.168.14.133。</p>
<p><em>因为我们是一台服务器一个rabbitmq服务，那么我们就不用在此之前停止management插件了。</em></p>
<h2 id="修改Erlang-cookie"><a href="#修改Erlang-cookie" class="headerlink" title="修改Erlang cookie"></a>修改Erlang cookie</h2><p>多服务器集群(一个服务器一个rabbitmq服务)与单机集群(一个服务器多个rabbitmq服务)。使每个节点的Erlang cookie相同，他们就可以互相通信。如果节点的Erlang cookie字符串不相同，那么当Erlang cookie节点尝试相互认证时会导致集群失败。</p>
<p>那么Erlang cookie在哪呢，官网上有介绍，当然也有最简单的办法，就是在先运行一下rabbitmq，然后查看日志，里面有你想要的信息。</p>
<p><img src="rabbitmq-7-设置集群/rabbitmq8.png" alt="jvm装载步骤"></p>
<p>在日志中可以看到我们的节点名称、home路径、日志路径等。我们根据home路径可知，.erlang.cookie文件就在root下。</p>
<p><img src="rabbitmq-7-设置集群/rabbitmq9.png" alt="jvm装载步骤"></p>
<p>修改一下.erlang.cookie的内容吧，做为测试，我将.erlang.cookie的内容改成AAAAAAAAAAAAAAAAAAAAAAAAA。</p>
<ul>
<li>因为.erlang.cookie是只读的，修改之前我们应该有修改权限</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 775 -R .erlang.cookie</span><br></pre></td></tr></table></figure>
<ul>
<li><p>修改里面的内容</p>
</li>
<li><p>一定要将.erlang.cookie的权限改回只读文件，否则启动的时候rabbitmq会提示你.erlang.cookie的权限不是只读的，保险起见，我们将.erlang.cookie的权限改回与之前一模一样。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 -R .erlang.cookie</span><br></pre></td></tr></table></figure>
<p>同样的方法，将其他两台服务器的.erlang.cookie也改为AAAAAAAAAAAAAAAAAAAAAAAAA。我们的第一步就算是做完了。</p>
<font color="red" size="4"><em>注意！！修改.erlang.cookie的时候，需要先将rabbitmq的服务停掉，修改过后之后，你会发现你无法使用rabbitmqctl stop的命令停止和rabbitmqctl status命令查看服务状态，都会提示你找不到之前的.erlang.cookie。如果遇到这种情况，可以根据rabbitmq的端口号来结束进程。</em></font>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 $(netstat -nlp | grep :5672 | awk '&#123;print $7&#125;' | awk -F"/" '&#123; print $1 &#125;')</span><br></pre></td></tr></table></figure>
<h2 id="修改hostname"><a href="#修改hostname" class="headerlink" title="修改hostname"></a>修改hostname</h2><p>因为rabbitmq的hostname不能是系统默认的，所以我们在做集群之前需要先改一下hostname。</p>
<p>查看hostname命令，然后可以可以在/etc/hostname下修改。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq10.png" alt="jvm装载步骤"></p>
<font color="red" size="4"><em>修改hostname之后需要重新启动，重启后生效。</em></font>

<p>然后进行与单服务器集群一样的设置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmq-server </span><br><span class="line">./rabbitmqctl  stop_app</span><br><span class="line">./rabbitmqctl  reset</span><br></pre></td></tr></table></figure>
<font color="red" size="4"><em>但是进行添加节点的时候，发现出问题了，问题如下</em></font>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl join_cluster rabbit@guo128</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-7-设置集群/rabbitmq11.png" alt="jvm装载步骤"></p>
<p>这是因为两个节点需要相互解析，所以最好在每个服务器上都记录一下服务器的ip以及名称。</p>
<p><img src="rabbitmq-7-设置集群/rabbitmq12.png" alt="jvm装载步骤"></p>
<p>设置好以后继续执行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl join_cluster rabbit@guo128</span><br><span class="line">./rabbitmqctl start_app</span><br></pre></td></tr></table></figure>
<p>最后查看一下集群状态，成功！</p>
<p><img src="rabbitmq-7-设置集群/rabbitmq13.png" alt="jvm装载步骤"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/26/rabbitmq-5-生产者和消费着的简单实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/26/rabbitmq-5-生产者和消费着的简单实现/" itemprop="url">rabbitmq-5-生产者和消费着的简单实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-26T15:18:03+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitmq-5-生产者和消费着的简单实现/r5.png" alt="jvm装载步骤"></p>
<p>在之前介绍这么多之后，我们也需要进行一下java代码的实现。</p>
<h1 id="direct交换器"><a href="#direct交换器" class="headerlink" title="direct交换器"></a>direct交换器</h1><h2 id="direct生产者"><a href="#direct生产者" class="headerlink" title="direct生产者"></a>direct生产者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.AMQP;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectSender</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">"log-direct"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ConnectionFactory factory=<span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">"192.168.14.128"</span>);</span><br><span class="line">        factory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">	<span class="comment">//设置vhost</span></span><br><span class="line">        factory.setVirtualHost(<span class="string">"test_vhost"</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String queue:声明的队列名称</span></span><br><span class="line"><span class="comment">         * boolean durable：是否队列持久化</span></span><br><span class="line"><span class="comment">         * boolean exclusive：是否为私有</span></span><br><span class="line"><span class="comment">         * boolean autoDelete：最后一个消费者取消订阅的时候，对列是否自动移出</span></span><br><span class="line"><span class="comment">         * Map&lt;String,Object&gt; arguments</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">		</span><br><span class="line">         <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *定义交换器的类型</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.exchangeDeclare(QUEUE_NAME,<span class="string">"direct"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">20</span>;i++)&#123;</span><br><span class="line">            String message = <span class="string">"Hello World"</span>+i+<span class="string">"!"</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">" [x] Sent '"</span> + message + <span class="string">"'"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="direct消费者"><a href="#direct消费者" class="headerlink" title="direct消费者"></a>direct消费者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectCustomer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME=<span class="string">"log-direct"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        ConnectionFactory factory=<span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">"192.168.14.128"</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">"test_vhost"</span>);</span><br><span class="line"></span><br><span class="line">        Connection connection=factory.newConnection();</span><br><span class="line">        <span class="keyword">final</span> Channel channel = connection.createChannel();</span><br><span class="line">		</span><br><span class="line">         <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * String queue:声明的队列名称</span></span><br><span class="line"><span class="comment">         * boolean durable：是否队列持久化</span></span><br><span class="line"><span class="comment">         * boolean exclusive：是否为私有</span></span><br><span class="line"><span class="comment">         * boolean autoDelete：最后一个消费者取消订阅的时候，对列是否自动移出</span></span><br><span class="line"><span class="comment">         * Map&lt;String,Object&gt; arguments</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *定义交换器的类型</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.exchangeDeclare(QUEUE_NAME,<span class="string">"direct"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 告诉服务器我们需要那个频道的消息，如果频道中有消息，就会执行回调函数</span></span><br><span class="line">        Consumer consumer=<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String message=<span class="keyword">new</span> String(body,<span class="string">"utf-8"</span>);</span><br><span class="line">                System.out.println(<span class="string">"Customer Received '"</span> + message + <span class="string">"'"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//订阅队列</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="keyword">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们这里在消费者和生产者都定义了队列和交换器，如果定义的队列信息一致，那么rabbitmq不会做出任何改变。如果你在运行消费者的时候定义了队列需要持久化，而在生产者的时候定义队列不需要持久化，那么就会出现错误。为了验证我们之前说过的，订阅到rabbitmq队列的多个消费者是顺序接收消息的，所以我们先启动两个消费者，再启动生产者。</p>
<p><strong>生产了创建了21条数据，并被两个消费者依次消费</strong></p>
<p><img src="rabbitmq-5-生产者和消费着的简单实现/rabbitmq1.png" alt="生产者"></p>
<p><img src="rabbitmq-5-生产者和消费着的简单实现/rabbitmq2.png" alt="消费者1"></p>
<p><img src="rabbitmq-5-生产者和消费着的简单实现/rabbitmq3.png" alt="消费者2"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/24/rabbitmq-4-rabbitmq中常用设置语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/24/rabbitmq-4-rabbitmq中常用设置语句/" itemprop="url">rabbitmq-4-rabbitmq中常用设置语句</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-24T15:13:05+08:00">
                2018-01-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitmq-4-rabbitmq中常用设置语句/r4.png" alt="jvm装载步骤"></p>
<p>我们在之前讲解了很多关于rabbitmq的构成以及设置语句，其实也很多，所以单独写一篇来记录。</p>
<h1 id="启动-关闭rabbitmq"><a href="#启动-关闭rabbitmq" class="headerlink" title="启动/关闭rabbitmq"></a>启动/关闭rabbitmq</h1><p>启动服务 ./rabbitmq-server </p>
<p>守护程序启动服务 ./rabbitmq-server -detached</p>
<p>启动守护进程会显示警告：Warning: PID file not written; -detached was passed.在后台启动服务器进程。请注意，这将导致pid不被写入到pid文件中。</p>
<p>停止服务 ./rabbitmqctl stop</p>
<p>停止远程节点 ./rabbitmqctl stop -n <a href="mailto:rabbit@192.168.14.130" target="_blank" rel="noopener">rabbit@192.168.14.130</a></p>
<h1 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h1><p>添加用户和密码： ./rabbitmqctl add_user admin admin </p>
<p>查看用户列表： ./rabbitmqctl list_users</p>
<p>修改用户密码： ./rabbitmqctl change_password admin admintest</p>
<p>设置/修改用户在test_vhost的权限(配置、写、读)：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl set_permissions -p test_vhost \admin ".*" ".*" ".*"</span><br></pre></td></tr></table></figure></p>
<h1 id="vhost"><a href="#vhost" class="headerlink" title="vhost"></a>vhost</h1><p>添加vhost: ./rabbitmqctl add_vhost test_vhost </p>
<p>查看vhost列表: ./rabbitmqctl list_vhosts </p>
<p>查看test_vhost下的用户权限：./rabbitmqctl list_permissions -p test_vhost</p>
<p>删除用户权限：./rabbitmqctl clear_permissions -p test_vhost admin</p>
<h1 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h1><p>显示test_vhost下的队列：./rabbitmqctl list_queues -p test_vhost</p>
<h1 id="交换器"><a href="#交换器" class="headerlink" title="交换器"></a>交换器</h1><p>显示test_vhost下的交换器及其绑定：./rabbitmqctl list_exchanges -p test_vhost</p>
<p>查看交换器与队列的绑定关系: ./rabbitmqctl list_bindings -p test_vhost</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/18/rabbitmq-3-运行和管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/18/rabbitmq-3-运行和管理/" itemprop="url">rabbitmq-3-运行和管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-18T17:41:15+08:00">
                2018-01-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitmq-3-运行和管理/r3.png" alt="jvm装载步骤"></p>
<h1 id="服务器管理"><a href="#服务器管理" class="headerlink" title="服务器管理"></a>服务器管理</h1><p>启动服务 ./rabbitmq-server </p>
<p>守护程序启动服务 ./rabbitmq-server -detached</p>
<p>启动守护进程会显示警告：Warning: PID file not written; -detached was passed.在后台启动服务器进程。请注意，这将导致pid不被写入到pid文件中。</p>
<p>停止服务 ./rabbitmqctl stop</p>
<p>停止远程节点 ./rabbitmqctl stop -n <a href="mailto:rabbit@192.168.14.130" target="_blank" rel="noopener">rabbit@192.168.14.130</a></p>
<h1 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h1><p><strong>添加一个账户为admin,密码为admin的用户</strong></p>
<p>./rabbitmqctl add_user admin admin </p>
<p><img src="rabbitmq-3-运行和管理/rabbitmq1.png" alt="你想输入的替代文字"></p>
<p><strong>查看用户列表</strong></p>
<p>./rabbitmqctl list_users</p>
<p><img src="rabbitmq-3-运行和管理/rabbitmq2.png" alt="你想输入的替代文字"></p>
<p><strong>修改用户密码</strong></p>
<p>将admin用户的密码修改为admintest</p>
<p>./rabbitmqctl change_password admin admintest</p>
<p><img src="rabbitmq-3-运行和管理/rabbitmq3.png" alt="你想输入的替代文字"></p>
<h1 id="rabbitMQ权限系统"><a href="#rabbitMQ权限系统" class="headerlink" title="rabbitMQ权限系统"></a>rabbitMQ权限系统</h1><p>rabbitMQ创建用户，然后为其赋予权限。rabbitmq的权限分为读、写、配置三个方面。RabbitMQ用户一个好的地方就是在于单个用户可以跨越多个vhost用户进行授权。当应用程序需要跨越多个安全域进行通信时(使用虚拟机进行隔离)，这会极大地方便访问控制的管理。</p>
<p><strong>读-有关消费信息的任何操作，包括”清除”整个队列(同样需要绑定操作成功)。</strong></p>
<p><strong>写-发布消息(同样需要绑定操作成功)。</strong></p>
<p><strong>配置-队列和交换器的创建和删除。</strong></p>
<p>每一个访问条目由一下四部分组成：</p>
<p>被授予访问权限的用户。</p>
<p>权限控制应用的vhost。</p>
<p>需要手语的读/写/配置权限的组合。</p>
<p>权限范围-权限控制仅应用于客户端命名的队列和交换器呢，还是仅用于服务器端的命名的队列/队列呢？抑或者两者兼顾？客服端命名意味着由你的应用程序设置交换器/队列的名称;服务器端命名意味着你的应用程序不提供名字而是让服务器随机指派。</p>
<p>谨记：访问控制条目是无法跨越vhost的。举例来说，如果你想要给用户admin在vhost A和vhost B上赋予相同的权限，那么你必须创建两份访问控制目录(每一个vhost一份)。</p>
<p>之前我们创建了一个vhost名为test_vhost,如果想让admin用户赋予完全的访问权限(读、写、配置)。</p>
<h2 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h2><p>-p test_vhost 为那个vhost设置权限<br>\admin 哪个用户<br>“.<em>“ 所有的权限<br>“check-.</em>“ 只匹配名字以”check-“开头的队列和交换器。<br>“” 不匹配队列和交换器（这就是如何对用户拒绝指定的权限）</p>
<p>“.<em>“ “.</em>“ “.*” 配置的顺序依次为配置、写、读。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl set_permissions -p test_vhost \admin ".*" ".*" ".*"</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-3-运行和管理/rabbitmq4.png" alt="你想输入的替代文字"></p>
<h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><p>检查一下vhost（以test_vhost）下的用户权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_permissions -p test_vhost</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-3-运行和管理/rabbitmq5.png" alt="你想输入的替代文字"></p>
<p>如果在vhost_test下，允许admin用户对任何队列或者交换器可执行读操作，同时限制其只能对名字以”check-“开始的队列和交换器可执行读操作，同时限制这个用户不能进行配置。根据上面的介绍，你应该如此配置。</p>
<p><img src="rabbitmq-3-运行和管理/rabbitmq6.png" alt="你想输入的替代文字"></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>删除test_vhost下的admin的权限设置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl clear_permissions -p test_vhost admin</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-3-运行和管理/rabbitmq7.png" alt="你想输入的替代文字"></p>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p>其实修改就是跟添加是一个语法啦，会覆盖之前的。</p>
<h1 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h1><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p><strong>列出默认的vhost(只是默认的vhost而不是所有的vhost的队列)队列信息和数量</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_queues</span><br></pre></td></tr></table></figure></p>
<p><strong>列出vhost名为test_vhost队列信息和数量：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_queues -p test_vhost</span><br></pre></td></tr></table></figure></p>
<p><img src="rabbitmq-3-运行和管理/rabbitmq8.png" alt="你想输入的替代文字"></p>
<p>查看队列的更多信息，举几个比较常用的<br>name:名称<br>messages：数量<br>consumers：附加的消费者数目<br>memory：占用的内存<br>durable:队列是否持久化<br>auto_delete:队列消息没有时是否删除队列</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_queues -p test_vhost name messages consumers memory durable auto_delete</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-3-运行和管理/rabbitmq9.png" alt="你想输入的替代文字"></p>
<h2 id="交换器和绑定"><a href="#交换器和绑定" class="headerlink" title="交换器和绑定"></a>交换器和绑定</h2><p><strong>查看默认vhost：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_exchanges</span><br></pre></td></tr></table></figure></p>
<p><strong>列出vhost名为test_vhost：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_exchanges -p test_vhost</span><br></pre></td></tr></table></figure></p>
<p><img src="rabbitmq-3-运行和管理/rabbitmq10.png" alt="你想输入的替代文字"></p>
<p>当然你也可以输出更详细的</p>
<p><exchangeinfoitem> must be a member of the list [name, type, durable, auto_delete, internal, arguments, policy].</exchangeinfoitem></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/15/rabbitmq-2-理解消息通讯及构造/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/15/rabbitmq-2-理解消息通讯及构造/" itemprop="url">rabbitmq-2-理解消息通讯及构造</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-15T15:32:22+08:00">
                2018-01-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitmq-2-理解消息通讯及构造/r2.png" alt="jvm装载步骤"></p>
<p><strong>在rabbitmq-1这篇博客里，是介绍如何安装erlang以及rabbitmq，和远程客户端的连接。但是我们还没理解什么是rabbitmq以及它其中的构造，这篇博客是我看完部分《RabbitMQ实战》这本书的理解。</strong></p>
<h1 id="生产者和消费者模式"><a href="#生产者和消费者模式" class="headerlink" title="生产者和消费者模式"></a>生产者和消费者模式</h1><p>我们正常接触到的都是B/S或者C/S架构，都是一端发送请求，另一端处理数据。消息队列实现模式并不是这样的，举个例子来讲，我们都吃过自助餐，有一个自助餐桌，用来放厨师做出来的菜，厨师就相当于生产者，而消息就相当于放在自助餐桌里的菜，顾客就是消费者，消费者在自助餐桌上拿了一道菜，他甚至不知道这道菜是谁做的。这就起到了应用程序间解耦的作用。</p>
<h1 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h1><p>生产者创建消息，然后发布到代理服务器(rabbitmq)。消息分为两部分：有效载荷(payload)和标签(label)。有效载荷就是你想要发送的数据，它可以是任何内容。标签描述了有效载荷，并且RabbitMQ用来它来决定谁将获得信息的拷贝。举例来说，不同于TCP协议来说，当你明确了指定的发送方和接收方时，AMQP只会用标签来表述这条信息（一个交换器的名称和可选的主题标记），然后把消息交给rabbitmq。rabbit会根据标记把信息发送给感兴趣的接收方。这种通讯方式是一种”发后即忘”的单项模式。生产者会创建消息并且设置标签。</p>
<p>消费者连接到代理服务器上，并订阅到队列(queue)上。每当一个消息到达队列后，rabbitmq会将其发送给其中一个订阅的/监听的消费者。当消费者接收消息的时候，只会接收有效载荷。所以rabbitmq不会告诉你是谁生产了/发送了信息。就想我们刚才举得例子，顾客根本不知道这道菜是哪个厨师做的，如果想知道这道菜是谁做的，就是他在他的菜品上写了自己的名字。如果需要明确知道是谁生产的AMQP消息的话，就要看生产了是否把发送方的信息放到有效载荷中。</p>
<h1 id="传输方式：信道"><a href="#传输方式：信道" class="headerlink" title="传输方式：信道"></a>传输方式：信道</h1><p>生产者生产消息，并且发送给rabbitmq；消费者从rabbitmq哪里接收消息。那么生产者是如何将信息发送给rabbitmq，消费者又怎样接收的呢，靠的是就是信道，英文名字为Channel，是不是觉得有点熟悉，NIO里面也有Channel，多个Channel被一个Selector包含。其实rabbit信道同样也是，多个channel对一个TCP连接。无论是发布消息、订阅队列或者接收消息，都是通过信道完成的。为什么不直接用TCP连接？因为对于操作系统来说，建立和销毁TCP会话是非常昂贵的开销，操作系统每秒也就能建立不多数量的TCP连接，这样如果每秒的请求有千万级的话，这种方式很快就成为性能瓶颈了。信道的好处，是建立一个TCP连接，然后里面建立成百上千的信道也不会影响操作系统，而且线程之间还能保持私密性。相当于每条电缆中有多条光纤束一样都可以传输，允许所有连接的线程通过多条光钎束同时进行传输和接收。</p>
<h2 id="java中创建信道"><a href="#java中创建信道" class="headerlink" title="java中创建信道"></a>java中创建信道</h2><p>我们需要在连接工厂来创建一个连接，根据这个连接我们来获取信道。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory factory=<span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">      factory.setHost(<span class="string">"192.168.14.128"</span>);</span><br><span class="line">      factory.setUsername(<span class="string">"test"</span>);</span><br><span class="line">      factory.setPassword(<span class="string">"test"</span>);</span><br><span class="line">      factory.setPort(<span class="number">5672</span>);</span><br><span class="line">      Connection connection = factory.newConnection();</span><br><span class="line">      Channel channel = connection.createChannel();</span><br></pre></td></tr></table></figure>
<h1 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h1><p>首先，要确定的是，AMQP路由有三部分组成：交换器、队列和绑定。</p>
<h2 id="队列的订阅方式"><a href="#队列的订阅方式" class="headerlink" title="队列的订阅方式"></a>队列的订阅方式</h2><p>（1）通过AMQP的basic.consume命令订阅，这样会将信道设置为接收模式，直到取消对队列的订阅为止。订阅了消息之后，消费者在消费（或者拒绝）最近接收的消息后，就能从队列（可用的）自动接收下一条消息，如果消费者处理队列消息，并且/或者需要在信息一达到队列时就自动接受的话，你应该使用basic.consume。</p>
<p>（2）某些时候，你只想从队列获得单条消息而不是持续订阅。向队列请求单挑消息通过AMQP的basic.get命令实现的。这样做可以让消费者接收队列的下一条信息。如果要获得更多的信息的话，需要再次发送basic.get命令。不要将basic.get写进循环里代替basic.consume，那会影响rabbitmq的性能。</p>
<h2 id="队列处理消息"><a href="#队列处理消息" class="headerlink" title="队列处理消息"></a>队列处理消息</h2><p>如果至少有一个消费者订阅了队列的话，消息会立即发送给这些订阅的消费者。如果消息到达了一个无人订阅的队列，那么消息就会在队列里一直进行等待消费。</p>
<p>当消息有多个消费者的时候，队列收到的消息会以循环的方式发送给消费者。每条消息只会发送给一个消费者。<br>如果有消费者A，B同时订阅了seed队列的话，消息分发是这样的。</p>
<p><strong>消息one到达seed队列</strong></p>
<p><strong>rabbitmq将信息发送给消费者A</strong></p>
<p><strong>消费者确认接收到了消息one</strong></p>
<p><strong>rabbitmq把消息one从seed队列移除</strong></p>
<p><strong>消息two到达seed队列</strong></p>
<p><strong>rabbitmq把消息two发送给消费者B</strong></p>
<p><strong>消费者B确认接收到了消息two</strong></p>
<p><strong>rabbitmq把消息two从seed队列中移除</strong></p>
<p>我们看到消费者A和消费者B都对消息进行了确认。消费者接收到的每一条消息都必须进行确认。消费者必须通过AMQP的basic.ack命令显示地想RabbitMQ发送一个确认，或者在订阅到队列的时候就将auto_ack命令设置为true。当设置了auto_ack时，一旦消费者接收消息，RabbitMQ会自动视其确认了消息。需要记住的是，消费者对消息的确认和告诉生产者消息已经被接收了这两件事毫无关联。因此，消费者通过命令告诉RabbitMQ它已经正确地接收到了消息，同时RabbitMQ才能安全地把消息从队列中删除。</p>
<p>如果消费者收到一条消息，然后确认之前从Rabbit断开连接（或者从队列取消订阅），RabbitMQ会认为这条消息没有分发，然后重新分发给下一个订阅的消费者。如果你的应用程序崩溃了，这样做可以确保消息会被发送给另一个消费者进行处理。另一方面，如果应用程序有bug而忘记确认的话，RabbitMQ将不会给该消费者发送更多的信息了。这是因为在上一条消息确认之前，RabbitMQ会认为这个消费者没有准备好接收下一条消息。我们可以好好利用这一点，如果处理消息的内容非常耗时，则你得应用程序可以延迟确认该消息，知道消息处理完成。这样可以防止RabbitMQ持续不断的消息涌向你的应用而导致过载。</p>
<h2 id="java中创建队列"><a href="#java中创建队列" class="headerlink" title="java中创建队列"></a>java中创建队列</h2><p>在java可以使用信道来创建队列。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* String queue:声明的队列名称</span></span><br><span class="line"><span class="comment">* boolean durable：是否队列持久化</span></span><br><span class="line"><span class="comment">* boolean exclusive：是否为私有</span></span><br><span class="line"><span class="comment">* boolean autoDelete：最后一个消费者取消订阅的时候，对列是否自动移出</span></span><br><span class="line"><span class="comment">* Map&lt;String,Object&gt; arguments</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h1 id="交换器和绑定"><a href="#交换器和绑定" class="headerlink" title="交换器和绑定"></a>交换器和绑定</h1><p>根据我们之前说的那样，消费者从队列中获取消息，可以消息是怎么样传到队列里的呢？是通过交换器和绑定。当你想将消息传递给队列的时候，需要通过消息发送给交换器来完成。然后，根据确定的规则，RabbitMQ会决定消息该投递给哪个队列。这个规则被称为路由键。队列通过路由器绑定到交换器。当你把消息发动给代理服务器时，消息将拥有一个路由键，即使是空的，RabbitMQ也会将其和绑定使用的路由器进行匹配。如果想匹配的话，那么消息就会进入队列中。如果路由的消息不匹配任何绑定模式的话，消息将进入黑洞。</p>
<h2 id="交换器"><a href="#交换器" class="headerlink" title="交换器"></a>交换器</h2><p>服务器会根据路由键消息从交换器路由队列，但是它如何处理投递到多个队列的情况的呢？协议中定义的不同类型的交换器发挥了作用。一共有四种类型：direct、fanout、topic和headers。每一种类型实现了不同的路由算法。由于我是看《RabbitMQ实战》这本书进行学习，作者提到headers交换器允许你匹配AMQP消息的header而非路由键。除此之外，headers交换器和direct交换器完全一样，但是性能会差很多。因此它不太实用，并且现在几乎再也用不到了，那么我们就不介绍了。</p>
<h3 id="direct交换器"><a href="#direct交换器" class="headerlink" title="direct交换器"></a>direct交换器</h3><p><strong>如果路由键匹配的话，消息就被投递到对应的队列。</strong></p>
<p>direct交换器就是路由键匹配的话，消息就被投递到对应的队列。服务器必须实现direct类型的交换器，并且包含了一个空白字符串的默认交换器。当你声明一个队列的时候，他就自动绑定到这个默认的交换器上，并以队列名称作为路由键。</p>
<p>队列与交换器进行绑定，并且向发送消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* String exchange:交换器名称</span></span><br><span class="line"><span class="comment">* String routingKey：路由键</span></span><br><span class="line"><span class="comment">* AMQP.BasicProperties props：</span></span><br><span class="line"><span class="comment">* byte[] body：发送的消息的内容</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">basicPublish(String exchange, String routingKey, AMQP.BasicProperties props, <span class="keyword">byte</span>[] body)</span><br></pre></td></tr></table></figure>
<p>向默认的交换器,以及路由键发送消息，因为direct交换器中，路由键与队列是一对一的，路由键的名称就是队列的名称。所以在在这个发送消息的时候虽然没有体现队列，但是已经制定了你的数据传给了哪个队列，这是redict交换器中特有的，需要注意一下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="keyword">null</span>, message.getBytes());</span><br></pre></td></tr></table></figure>
<p>如果想更换交换器，我们可以设置自己的交换器。使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* String exchange:交换器名称</span></span><br><span class="line"><span class="comment">	* BuiltinExchangeType type：交换器类型</span></span><br><span class="line"><span class="comment">	* </span></span><br><span class="line"><span class="comment">	**/</span></span><br><span class="line">exchangeDeclare(String exchange, BuiltinExchangeType type)</span><br></pre></td></tr></table></figure>
<h3 id="fanout交换器"><a href="#fanout交换器" class="headerlink" title="fanout交换器"></a>fanout交换器</h3><p>这个类型的交换器将收到的信息广播绑定到队列上。当你发送一条信息到fanout交换器的时候，他会把消息投递给所有附加在此交换器上的队列。</p>
<p>这个交换器我觉得应用场景会很多。假如说现实生活中，你有一张银行卡，你开通了手机银行，同时你的银行卡也绑定了支付宝、微信。当你使用这张卡完成支付后，那么需要手机银行给你发送一条短信，我支付了多少钱。同时支付宝、微信也会在自己的软件中进行通知。这就可以使用fanout交换器，让三个队列分别与fanout的交换器进行绑定，不用改生产者的任何代码，就可以解决这个问题。</p>
<h3 id="topic交换器"><a href="#topic交换器" class="headerlink" title="topic交换器"></a>topic交换器</h3><p>topic交换器允许你实现有趣的消息通讯场景，它使得来自不同源头的消息能够到达同一队列。如果拿Web应用程序作为示例。我们拥有不同的日志级别，error、info、warning等。于此同时，你的应用程序分为一下几个模块，users、product、org等。如果你在对用户模块进行操作的时候，你想报告一个error的话，则可以这样写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.basicpublic(<span class="string">"logs-exchanges"</span>,<span class="string">"error-users"</span>,<span class="keyword">null</span>,message);</span><br></pre></td></tr></table></figure>
<p>加入你声明了一个user-errors的队列，你可以将其绑定到交换器上来接收消息，如下所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queueBind(String queue, String exchange, String routingKey)</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.queueBind(<span class="string">"user-errors"</span>,<span class="string">"logs-exchanges"</span>,<span class="string">"error-users"</span>);</span><br></pre></td></tr></table></figure>
<p>到目前为止，这看起来跟direct交换器很像。但是如果你想用一个队列监听users模块的所有错误级别呢，这就这需要使用topic交换器了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.queueBind(<span class="string">"user-logs"</span>,<span class="string">"logs-exchanges"</span>,<span class="string">"*.-users"</span>);</span><br></pre></td></tr></table></figure>
<p>user-logs这个队列可以接收所有从users模块接收模块发来的所有error,warning和info的日志。如果要是一个队列接收所有模块的所有的错误的信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.queueBind(<span class="string">"all-logs"</span>,<span class="string">"logs-exchanges"</span>,<span class="string">"#"</span>);</span><br></pre></td></tr></table></figure>
<p>这样all-logs就可以接收所有传入logs-exchanges的消息了。这时候可能会问，那岂不是不是日志的消息也会放入all-logs吗？我们建立了一个logs-exchanges这个交换器，就是专门放日志的。所以对于交换器来说，不仅要选对类型，还要根据名字来来决定他的功能性。</p>
<h1 id="虚拟主机vhost"><a href="#虚拟主机vhost" class="headerlink" title="虚拟主机vhost"></a>虚拟主机vhost</h1><p>每一个RabbitMQ都会创建一个虚拟消息服务器，我们称之为虚拟主机(vhost)。每一个vhost本质上是一个mini版的RabbitMQ服务器，拥有自己的队列、绑定、交换器。最重要的是，它拥有自己的权限控制。他们通过在各个实例间提供逻辑上分离，允许你为不同的应用程序安全保密地运行数据。这很有用，它既能将同一Rabbit的众多客户区分开来，又可以避免队列和交换器命名的冲突。负责你可能不得不运行多个Rabbit，并忍受随之而来头疼的管理问题。相反，你可以只运行一个Rabbit，然后按需启动和关闭vhost。</p>
<p>vhost是AMQP概念的基础，你必须在连接时指定。由于RabbitMQ包含了开箱即用的默认的vhost:”/“，因此使用起来非常简单。如果你不需要多个vhost的话，那么就使用默认的吧。通过使用缺省的guest用户名和密码guest就可以访问默认vhost。</p>
<p>当你在RabbitMQ里创建一个用户，用户通常会被制定给至少一个vhost，并且只能访问被指派的vhost内的队列、交换器和绑定。当你设计消息通讯架构时，记住vhost之间是绝对隔离的。你无法将vhost A上的交换器绑定到 vhost B上的队列中。这既保证了安全性，又保证了可移植性。当你在RabbitMQ集群上创建vhost时，整个集群上都会创建该vhost。vhost不仅消除了为基础架构中的每一层运行一个RabbitMQ服务器的需要，同样也避免了每一层创建不同集群。</p>
<p>vhost的创建和权限控制非常独特，他们是AMQP中无法通过AMQP协议创建的基元(不同于队列，交换器和绑定)。对于RabbitMQ来说，你需要通过RabbitMQ的安装路径下的./sbin/目录中的rabbitmqctl工具来创建。</p>
<p>新建一个名为test_vhost的vhost</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl add_vhost test_vhost</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-2-理解消息通讯及构造/vhost1.png" alt="你想输入的替代文字"></p>
<p>查看当前vhost列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl list_vhosts</span><br></pre></td></tr></table></figure>
<p><img src="rabbitmq-2-理解消息通讯及构造/vhost2.png" alt="你想输入的替代文字"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/11/rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/11/rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/" itemprop="url">rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-11T19:33:01+08:00">
                2018-01-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/r1.png" alt="jvm装载步骤"></p>
<p>首先应在rabbitMQ官网查看需要下载的版本，我们选择的是3.7.2，根据rabbitMQ的版本在erlang选择支持的版本，这里我们选择的是erlang是20.1。我是新建一个虚拟机进行配置，所以使用的root用户进行文件的安装。</p>
<h1 id="安装erlang"><a href="#安装erlang" class="headerlink" title="安装erlang"></a>安装erlang</h1><p><strong>首先现在官网下载erlang</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.erlang.org/download/otp_src_20.1.tar.gz</span><br></pre></td></tr></table></figure></p>
<p><strong>安装erlang依赖包</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ unixODBC-devel  openssl-devel ncurses-devel</span><br></pre></td></tr></table></figure>
<p><strong>解压压缩包</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf otp_src_20.1.tar.gz</span><br></pre></td></tr></table></figure>
<p><strong>将解压文件修改名字，并移动到自己的软件安装目录下</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv otp_src_20.1 erlang20.1</span><br></pre></td></tr></table></figure>
<p><strong>进入erlang20.1目录下</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/erlang20.1 -with-ssl -enable-rhreads -enable-smp-support -enable-kernel-poll -enable-hipe -without-javac</span><br></pre></td></tr></table></figure>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/erlang2.png" alt="jvm装载步骤"></p>
<p><em>如果提示以上界面，说明erlang的配置项没有问题，再进行编译</em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>验证是否安装成功，进入bin/目录下，查看是否存在erl文件</p>
<p>./erl </p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/erlang3.png" alt="jvm装载步骤"></p>
<p>使用halt().退出</p>
<p><strong>我们为了能让erl全局使用，需设置环境变量，我如果只想在guojian用户下使用环境变量，就需要修改.bash_profile。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:/usr/local/erlang20.1/bin</span><br></pre></td></tr></table></figure>
<p>保存退出后，直接使.bash_profile生效<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bash_profile</span><br></pre></td></tr></table></figure></p>
<h1 id="安装rabbitMQ"><a href="#安装rabbitMQ" class="headerlink" title="安装rabbitMQ"></a>安装rabbitMQ</h1><h2 id="rabbit安装部分"><a href="#rabbit安装部分" class="headerlink" title="rabbit安装部分"></a>rabbit安装部分</h2><p>我们首先下载下来的文件包rabbitmq-server-generic-unix-3.7.2.tar.xz</p>
<p>首先它是一个XXX.tar.xz的格式，我们先要给他解压成tar格式的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xz -d rabbitmq-server-generic-unix-3.7.2.tar.xz</span><br></pre></td></tr></table></figure>
<p>然后再解压tar包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf rabbitmq-server-generic-unix-3.7.2.tar</span><br></pre></td></tr></table></figure>
<p>移动rabbitmq 到软件的目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv rabbitmq_server-3.7.2/ /usr/local/rabbitmq-3.7.2</span><br></pre></td></tr></table></figure>
<p>进入rabbitmq-3.7.2的sbin目录下</p>
<p>执行 ./rabbitmq-server start</p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq1.png" alt="jvm装载步骤"></p>
<p>如果出现rabbitmq的版本信息，说明你的rabbitmq已经启动了。</p>
<p><strong>查看rabbitmq的状态</strong><br>./rabbitmqctl status</p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq2.png" alt="jvm装载步骤"></p>
<p>如果你输入显示的是如下图所示，说明你没有配置erlang的环境变量，上面有。</p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq3.png" alt="jvm装载步骤"></p>
<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><p><strong>查看用户</strong></p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq4.png" alt="jvm装载步骤"></p>
<p>我们可以看到有一个用户是guest，权限是administrator。这个地方是什么我们下一章会总体说明。因为guest是默认用户，所以它没有外网访问的权限，我们需要新建一个用户，才能完成不是非本地的连接。</p>
<p>添加一个用户，名为test，密码为test</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl add_user test test</span><br></pre></td></tr></table></figure>
<p>为用户test赋予权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rabbitmqctl set_permissions -p / test ".*"  ".*"  ".*"</span><br></pre></td></tr></table></figure>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq5.png" alt="jvm装载步骤"></p>
<p>在centos7开放端口，rabbitmq的默认端口是5672</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=5672/tcp --permanent</span><br></pre></td></tr></table></figure>
<p>重启生效<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure></p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq6.png" alt="jvm装载步骤"></p>
<p>远程客户端访问一下试试吧。</p>
<p>所依赖的jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ConnectionFactory factory=<span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">"192.168.14.128"</span>);</span><br><span class="line">        factory.setUsername(<span class="string">"test"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"test"</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        String message = <span class="string">"Hello World!"</span>;</span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">" [x] Sent '"</span> + message + <span class="string">"'"</span>);</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="rabbitMQ-1-cenotOS7下erlang、rabbitMQ安装/rabbitmq7.png" alt="jvm装载步骤"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/09/springBoot-1-简单实例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/09/springBoot-1-简单实例/" itemprop="url">springBoot-1-简单实例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-09T16:45:46+08:00">
                2018-01-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用idea构建Maven项目 <a href="http://guojian.fun/2017/12/11/idea-%E6%9E%84%E5%BB%BAmaven-web%E9%A1%B9%E7%9B%AE/" target="_blank" rel="noopener">idea-构建maven web项目</a> </p>
<h1 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>demo.msa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>msa-hello<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 步骤5 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>msa-hello Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 步骤1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 步骤2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 步骤3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>msa-hello<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 步骤4 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>步骤1：这样设置后，应用才是SpringBoot应用，该配置会继承大量的SpringBoot插件，但是这些插件都未启动。<br>步骤2：spring boot集成了servlet容器，当我们在pom文件中增加spring-boot-starter-web的maven依赖时，不做任何web相关的配置便能提供web服务。<br>步骤3：提供大量的生产机特性。<br>步骤4：添加Maven插件。<br>步骤5：将maven打包成jar包。</p>
<h1 id="springBoot程序"><a href="#springBoot程序" class="headerlink" title="springBoot程序"></a>springBoot程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  guojian</span></span><br><span class="line"><span class="comment"> * 简单的一个SpringBoot实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAppalication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(HelloAppalication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> 在类中使用@SpringBootApplication注解，表示它是Spring Boot应用</strong><br><strong> 在main()方法中通过SpringApplication的run()方法去运行该类</strong></p>
<h1 id="对外发布RESTAPI"><a href="#对外发布RESTAPI" class="headerlink" title="对外发布RESTAPI"></a>对外发布RESTAPI</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> guojian</span></span><br><span class="line"><span class="comment"> * 一个简单的 控制层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET,path = <span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们发现其实控制层与之前区别并不是很大，只是将@Controller换成了@RestController，@RestController表示它具备发布REST API的能力，并且将每个REST API的返回值自动序列化JSON格式。</p>
<p>注意控制层需要与你使用@SpringBootApplication注解的类在同一包下，负责无法找到这个controller。如果有疑问，可以看一下我之前写的有关spring全注解开发。</p>
<h1 id="运行SpringBoot应用程序"><a href="#运行SpringBoot应用程序" class="headerlink" title="运行SpringBoot应用程序"></a>运行SpringBoot应用程序</h1><p>1、IDEA上直接运行</p>
<p>直接启动main函数就好了</p>
<p>2、打成jar包，使用java命令运行</p>
<p>首先将pom.xml中的步骤1改为jar包，然后在如图所示</p>
<p><img src="springBoot-1-简单实例/springboot2.png" alt="你想输入的替代文字"></p>
<p>运行过后会在项目的target目录下生成jar包，然后进入target目录下执行命令</p>
<p>java -jar msa-hello.jar</p>
<p>3、使用maven运行</p>
<p>mvn spring-boot:run</p>
<p>这就需要使用pom.xml中步骤4的插件了，如果你没有，那么就无法执行了</p>
<p>登录浏览器访问一下</p>
<p><img src="springBoot-1-简单实例/springboot1.png" alt="你想输入的替代文字"></p>
<p>这是因为我们找不到路径为空的方法，所以就返回的错误界面。如果出现这个界面说明我们的springBoot发布成功了。</p>
<p><img src="springBoot-1-简单实例/springboot3.png" alt="你想输入的替代文字"></p>
<p>给了指定的路径，我们可以访问到我们想要的内容了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://guojian731.github.io/guojian731.github.io/guojian731.github.io/2018/01/08/微服务-1-了解微服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guo Jian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/guojian731.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/guojian731.github.io/2018/01/08/微服务-1-了解微服务/" itemprop="url">微服务-1-了解微服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-08T20:44:37+08:00">
                2018-01-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>有关微服务的相关知识我是看《轻量级微服务架构》这本书作为我的微服务启蒙老师。</strong></p>
<h1 id="微服务解决哪些问题"><a href="#微服务解决哪些问题" class="headerlink" title="微服务解决哪些问题"></a>微服务解决哪些问题</h1><p>1、传统的架构，是当服务端发出请求后，一个应用程序会有若干个模块组成，Module A,Module B,Module C<br>但是根据业务逻辑不同，C占用的系统资源比较高，运行一段时间，C就会成为整个系统的瓶颈。我们如何解决呢，就会使用分布式来将请求分流，来降低服务器的压力，使每个服务器的都能正常负载，叫做负载均衡。问题是得到了解决，但是相对于A，B来说，两个占用系统资源小，也同样因为C的原因进行了水平扩展，就会造成系统浪费。假设一下，一个互联网产品，每秒可能一个功能模块会被访问十多万次，水平扩展很有必要，项目中同样有一个模块只有管理员身份才能操作，而具有管理员权限的只有不到50人。那么管理员模块就没必要扩展这么多次，造成不必要的浪费。</p>
<p><img src="微服务-1-了解微服务/springboot1.png" alt="你想输入的替代文字"></p>
<p>2、越大的项目部署起来就需要越长的时间，加入你只改了一段代码，但是却要部署整个应用，部署效率太低。<br>3、将单个模块服务可能有更适合的语言，就可以使用，而不是想传统项目一样必须都使用java，造成技术选型单一。</p>
<h1 id="微服务架构要求："><a href="#微服务架构要求：" class="headerlink" title="微服务架构要求："></a>微服务架构要求：</h1><p><strong>1、根据业务模块划分服务类型。</strong><br><strong>2、每个服务可独立部署并且相互隔离。</strong><br><strong>3、通过轻量级API调用服务。</strong><br><strong>4、服务需保证良好的高可用性。</strong></p>
<p>我们需要根据业务的模块进行划分，就基金系统来说来书用户模块、产品模块、订单模块等。其中，每个模块都可以独立的部署，且相互隔离，每个服务可以独立的启动，不会依赖于其他服务。项目应该少耦合，但是不可能没有耦合，那样就是毫不相关的两个事，如果想根据用户id获取他之前所有的订单，就是耦合，我们应该通过HTTP或RPC的方式来调用，目的是为了降低调用所产生的性能开销。高可用性，就是每个服务都是分布式的，不可能只有一个，当这个服务无法响应时，可以调用没有发生故障的服务。</p>
<h1 id="微服务的特点"><a href="#微服务的特点" class="headerlink" title="微服务的特点"></a>微服务的特点</h1><p>1、服务颗粒化<br>服务之间的颗粒度要尽可能的小，但是服务之间又不能有过多的依赖。</p>
<p>2、责任单一化<br>用户模块只负责用户相关的功能，做到”单一职责原则”。什么是”单一职责原则”，我们平常做项目的时候，会有User类，以及他的功能类来处理相关逻辑，为什么不把他们放在一起呢，就是因为”单一职责原则”，POJO类只负责管理属性，功能类只负责处理逻辑。</p>
<p>3、运行隔离化</p>
<p>每个服务相互隔离，互不影响。每个服务都运行在自己的进程中，一个进程内部资源是共享的，不同的进程资源是不共享的，一个服务出现了问题，不会影响到其他的服务。</p>
<p>4、管理自动化</p>
<p>随着业务越来越多，服务的数量越来越多，需要对服务提供自动化部署与监控预警的能力。</p>
<h1 id="微服务技术选型"><a href="#微服务技术选型" class="headerlink" title="微服务技术选型"></a>微服务技术选型</h1><p>1、通过SpringBoot开发服务<br>2、使用Docker封装服务<br>3、使用Zookeeper注册服务<br>4、使用Node.js调用服务<br>5、使用Jenkins部署服务</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/guojian731.github.io/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/guojian731.github.io/page/4/">4</a><a class="extend next" rel="next" href="/guojian731.github.io/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Guo Jian</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/guojian731.github.io/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/guojian731.github.io/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guo Jian</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/guojian731.github.io/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/guojian731.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/guojian731.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/guojian731.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/guojian731.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/guojian731.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/guojian731.github.io/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/guojian731.github.io/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/guojian731.github.io/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/guojian731.github.io/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/guojian731.github.io/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
